<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Registro de Evidência Arqueológica</title>
  <style>
    body {
      background-color: #e9e5e5ec;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
    }

    .form-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .form-container input,
    .form-container select {
      padding: 10px;
      width: 260px;
      margin-bottom: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .form-container button {
      padding: 10px 20px;
      font-size: 16px;
      margin-bottom: 20px;
      border: none;
      border-radius: 5px;
      background-color: #66B284;
      cursor: pointer;
    }

    .sidebar {
      width: 400px;
      background-color: #008000;
      border-left: 5px solid #7a3b00;
      overflow-y: auto;
      padding: 20px;
    }

    .section {
      margin-bottom: 20px;
    }

    .section h3 {
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
      margin-bottom: 10px;
      color: white;
    }

    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #66B284;
      padding: 8px;
      margin-bottom: 5px;
      border-radius: 5px;
    }

    .item span {
      font-weight: bold;
      flex: 1;
    }

    .item img {
      max-width: 40px;
      max-height: 40px;
      margin-left: 10px;
      border-radius: 4px;
      object-fit: cover;
    }

    .item button {
      background-color: rgb(179, 197, 182);
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 3px;
      cursor: pointer;
      margin-left: 10px;
    }

    #imagem-preview {
      margin-bottom: 10px;
      max-width: 200px;
      max-height: 200px;
      display: none;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="form-container">

    <h1 style="text-align: center; font-size: 2.5em;">Registro arqueológico</h1>
    <input type="text" id="catalogo" placeholder="Nome do catálogo" />
    <select id="tipo">
      <option value="">Selecione o tipo</option>
      <option>Artefatos</option>
      <option>Restos de Construções</option>
      <option>Vestígios de Assentamentos Humanos</option>
      <option>Arte Rupestre</option>
      <option>Restos de Animais e Plantas</option>
      <option>Evidências de Rituais e Práticas Culturais</option>
    </select>
    <input type="file" id="imagem" accept="image/*" />
    <img id="imagem-preview" />
    <button id="confirmar" disabled>Confirmar</button>
  </div>

  <div class="sidebar" id="listaObjetos">
    <!-- Objetos aparecem aqui -->
  </div>

  <script>
    const catalogoInput = document.getElementById('catalogo');
    const tipoSelect = document.getElementById('tipo');
    const imagemInput = document.getElementById('imagem');
    const confirmarBtn = document.getElementById('confirmar');
    const listaObjetos = document.getElementById('listaObjetos');
    const imagemPreview = document.getElementById('imagem-preview');

    let objetos = JSON.parse(localStorage.getItem('objetos')) || [];
    let imagemBase64 = '';

    catalogoInput.addEventListener('input', verificarCampos);
    tipoSelect.addEventListener('change', verificarCampos);
    imagemInput.addEventListener('change', carregarImagem);

    function verificarCampos() {
      confirmarBtn.disabled = catalogoInput.value.trim() === '' || tipoSelect.value === '';
    }

    function carregarImagem(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          imagemBase64 = e.target.result;
          imagemPreview.src = imagemBase64;
          imagemPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    }

    confirmarBtn.addEventListener('click', () => {
      const nome = catalogoInput.value.trim();
      const tipo = tipoSelect.value;

      if (nome && tipo) {
        let index = objetos.findIndex(o => o === null);
        if (index === -1) index = objetos.length;

        objetos[index] = { nome, tipo, imagem: imagemBase64 || null };
        salvarEAtualizar();
        catalogoInput.value = '';
        tipoSelect.value = '';
        imagemInput.value = '';
        imagemPreview.src = '';
        imagemPreview.style.display = 'none';
        imagemBase64 = '';
        confirmarBtn.disabled = true;
      }
    });

    function salvarEAtualizar() {
      localStorage.setItem('objetos', JSON.stringify(objetos));
      renderizarObjetos();
    }

    function renderizarObjetos() {
      listaObjetos.innerHTML = '';
      const tiposAgrupados = {};

      objetos.forEach((obj, index) => {
        if (obj) {
          if (!tiposAgrupados[obj.tipo]) {
            tiposAgrupados[obj.tipo] = [];
          }
          tiposAgrupados[obj.tipo].push({ index, nome: obj.nome, imagem: obj.imagem });
        }
      });

      Object.keys(tiposAgrupados).forEach(tipo => {
        const secao = document.createElement('div');
        secao.className = 'section';
        secao.innerHTML = `<h3>${tipo}</h3>`;

        tiposAgrupados[tipo].forEach(obj => {
          const div = document.createElement('div');
          div.className = 'item';

          const span = document.createElement('span');
          span.textContent = `#${(obj.index + 1).toString().padStart(3, '0')} - ${obj.nome}`;

          const deleteBtn = document.createElement('button');
          deleteBtn.textContent = 'X';
          deleteBtn.onclick = () => deletar(obj.index);

          div.appendChild(span);

          if (obj.imagem) {
            const img = document.createElement('img');
            img.src = obj.imagem;
            div.appendChild(img);
          }

          div.appendChild(deleteBtn);
          secao.appendChild(div);
        });

        listaObjetos.appendChild(secao);
      });
    }

    function deletar(index) {
      objetos[index] = null;
      salvarEAtualizar();
    }

    renderizarObjetos();
  </script>
</body>
</html>
